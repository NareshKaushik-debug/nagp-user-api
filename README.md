# 🐳 Kubernetes DevOps Assignment – User API

This project demonstrates a complete containerized and orchestrated Node.js + MongoDB microservice running on Kubernetes. It includes persistent storage, Ingress-based routing, and self-healing capabilities via Kubernetes Deployment objects.

---

## 🔗 Project Links

- 📁 **Code Repository:** [https://github.com/NareshKaushik-debug/nagp-user-api/tree/master](https://github.com/NareshKaushik-debug/nagp-user-api/tree/master)
- 🐳 **Docker Image:** [https://hub.docker.com/repository/docker/nareshkaushik36/nagp-user-api/general](https://hub.docker.com/repository/docker/nareshkaushik36/nagp-user-api/general)
- 🌐 **Live API Endpoint:**  
  ```
  http://34.49.15.151/api/users
  ```

---

## 📦 Features Demonstrated

- Node.js backend exposing a REST API
- MongoDB database using Persistent Volume
- Dockerized and deployed via Kubernetes
- Ingress for routing external traffic
- Auto-recovery via pod self-healing
- End-to-end deployment validation

---

## 📽️ Screen Recording (Video Demo)

📹 [Click here to watch the video demo](https://drive.google.com/file/d/1P8dhdg-vXFOsy3vuoGz3lQ48fq2K5snJ/view?usp=sharing)

In this video:

- ✅ All Kubernetes objects are listed (Deployments, Pods, Services, PVC, etc.)
- ✅ REST API call (`GET /api/users`) is shown retrieving data from MongoDB
- ✅ API pod is killed → auto-regenerated by Deployment
- ✅ MongoDB pod is killed → data still persists via PVC

---

## ⚙️ API Endpoints

| Method | Endpoint       | Description               |
|--------|----------------|---------------------------|
| GET    | `/api/users`   | Fetch all users           |
| POST   | `/api/users`   | Add a new user            |

### Sample `POST`:
```bash
curl -X POST http://34.49.15.151/api/users \
  -H "Content-Type: application/json" \
  -d '{
        "name": "Alice 1",
        "email": "alice@example.com",
        "age": 25
      }'
```

### Sample `GET`:
curl http://34.49.15.151/api/users

### Sample response:
[
    {
        "_id": "68932898f0b8429bcc94164c",
        "name": "Alice 1",
        "email": "alice@example.com",
        "age": 25,
        "__v": 0
    },
    {
        "_id": "689328b1ae5325ddc15fe742",
        "name": "Alice 2",
        "email": "alice@example.com",
        "age": 25,
        "__v": 0
    },
    {
        "_id": "689335dbae5325ddc15fe9e5",
        "name": "Alice 3",
        "email": "alice@example.com",
        "age": 25,
        "__v": 0
    },
    {
        "_id": "689335eff0b8429bcc9418fd",
        "name": "Alice 4",
        "email": "alice@example.com",
        "age": 25,
        "__v": 0
    }
]

---

## 🧪 Testing Self-Healing

### Kill the API Pod:
```bash
kubectl delete pod -l app=user-api
```

Watch it regenerate:
```bash
kubectl get pods -l app=user-api -w
```

---

### Kill the MongoDB Pod:
```bash
kubectl delete pod -l app=mongo
```

Then check the data is still available:
```bash
curl http://34.49.15.151/api/users
```

✅ The old data is retained because MongoDB uses a PersistentVolume.

---

## 📁 Folder Structure

```
.
├── Dockerfile
├── docker-compose.yml
│── manifest.yaml             # API deployment, service, ingress
│── mongodb-manifest.yaml     # Mongo deployment + PVC
├── models/
│   └── User.js
├── server.js
└── README.md
```

---

## 🧠 Maintained By

**Naresh Kaushik**  
[GitHub Profile](https://github.com/NareshKaushik-debug)  
[Docker Hub](https://hub.docker.com/u/nareshkaushik36)
